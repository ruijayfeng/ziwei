# RULES - 持久化约束区

> 用户偏好、不可变护栏、架构决策

## 用户偏好

- **设计风格**: 温暖插画 + Apple 质感 + 星空主题
- **避免**: 廉价感、AI 蓝紫渐变僵硬质感、土味命理风
- **色彩**: 深靛蓝夜空 + 暖琥珀点缀
- **交互语言**: 中文
- **注释规范**: 中文 + ASCII 分块注释

## 不可变护栏

### 技术栈
- React 18 + TypeScript
- Vite 7
- Tailwind CSS 4
- iztro 排盘库
- Zustand 状态管理

### 部署约束
- 纯前端静态部署
- 数据存储在 localStorage / IndexedDB
- 无后端依赖

### 设计约束
- 文件不超过 800 行
- 文件夹每层不超过 8 个文件
- 函数不超过 20 行
- 缩进不超过 3 层

## 架构决策记录 (ADR)

### ADR-001: 纯前端架构
- **决策**: 纯前端静态应用，无后端
- **原因**: 开源自部署友好，Vercel 一键部署
- **影响**: API Key 存浏览器本地，数据无跨设备同步

### ADR-002: 多模型适配层
- **决策**: 支持 Kimi/Gemini/Claude/DeepSeek/自定义
- **原因**: 国内用户友好，降低使用门槛
- **影响**: 需维护多种 API 格式适配

### ADR-003: 结构化 RAG
- **决策**: 知识库按星曜/宫位/四化结构化存储，精确检索
- **原因**: 紫微斗数知识高度结构化，比向量检索更精准
- **影响**: 知识库需手动整理，但检索快速准确

### ADR-004: 混合知识检索
- **决策**: 离线知识库 + 可选联网搜索增强
- **原因**: 保证基础可用，同时支持深度扩展
- **影响**: 联网需用户配置搜索 API

## 功能规格

### 完整 MVP 功能
1. ✅ 命盘排盘（真太阳时校正）
2. ✅ AI 深度解读
3. ⏳ 年度运势
4. ⏳ 双人合盘
5. ⏳ 社交分享卡片

### 输入字段
| 字段 | 必填 | 说明 |
|------|------|------|
| 出生日期 | ✅ | 年月日 |
| 出生时间 | ✅ | 时辰 |
| 性别 | ✅ | 大限方向 |
| 出生地 | ⚪ | 真太阳时校正 |
| 关注方向 | ⚪ | AI 深度解读 |
