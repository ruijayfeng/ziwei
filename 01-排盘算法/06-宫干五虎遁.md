# 宫干排布（五虎遁）

## 概述

十二宫的天干由**年干**推算，使用"五虎遁"口诀。宫干用于：
1. 确定四化星飞入
2. 推算大限流年

---

## 一、五虎遁口诀

> **甲己之年丙作首，乙庚之岁戊为头**
> **丙辛必定寻庚起，丁壬壬位顺行流**
> **戊癸之年何方起，甲寅之上好追求**

### 年干起寅宫天干对照表

| 年干 | 寅宫起干 |
|------|---------|
| 甲、己 | 丙 |
| 乙、庚 | 戊 |
| 丙、辛 | 庚 |
| 丁、壬 | 壬 |
| 戊、癸 | 甲 |

---

## 二、完整宫干排布

从寅宫开始，天干按**顺序**（甲乙丙丁戊己庚辛壬癸）排布于十二宫。

### 各年干的十二宫天干

**甲/己年：**
| 宫位 | 寅 | 卯 | 辰 | 巳 | 午 | 未 | 申 | 酉 | 戌 | 亥 | 子 | 丑 |
|------|----|----|----|----|----|----|----|----|----|----|----|----|
| 天干 | 丙 | 丁 | 戊 | 己 | 庚 | 辛 | 壬 | 癸 | 甲 | 乙 | 丙 | 丁 |

**乙/庚年：**
| 宫位 | 寅 | 卯 | 辰 | 巳 | 午 | 未 | 申 | 酉 | 戌 | 亥 | 子 | 丑 |
|------|----|----|----|----|----|----|----|----|----|----|----|----|
| 天干 | 戊 | 己 | 庚 | 辛 | 壬 | 癸 | 甲 | 乙 | 丙 | 丁 | 戊 | 己 |

**丙/辛年：**
| 宫位 | 寅 | 卯 | 辰 | 巳 | 午 | 未 | 申 | 酉 | 戌 | 亥 | 子 | 丑 |
|------|----|----|----|----|----|----|----|----|----|----|----|----|
| 天干 | 庚 | 辛 | 壬 | 癸 | 甲 | 乙 | 丙 | 丁 | 戊 | 己 | 庚 | 辛 |

**丁/壬年：**
| 宫位 | 寅 | 卯 | 辰 | 巳 | 午 | 未 | 申 | 酉 | 戌 | 亥 | 子 | 丑 |
|------|----|----|----|----|----|----|----|----|----|----|----|----|
| 天干 | 壬 | 癸 | 甲 | 乙 | 丙 | 丁 | 戊 | 己 | 庚 | 辛 | 壬 | 癸 |

**戊/癸年：**
| 宫位 | 寅 | 卯 | 辰 | 巳 | 午 | 未 | 申 | 酉 | 戌 | 亥 | 子 | 丑 |
|------|----|----|----|----|----|----|----|----|----|----|----|----|
| 天干 | 甲 | 乙 | 丙 | 丁 | 戊 | 己 | 庚 | 辛 | 壬 | 癸 | 甲 | 乙 |

---

## 三、代码实现

```python
TIANGAN = ['甲', '乙', '丙', '丁', '戊', '己', '庚', '辛', '壬', '癸']
DIZHI = ['寅', '卯', '辰', '巳', '午', '未', '申', '酉', '戌', '亥', '子', '丑']

# 五虎遁起点
WUHU_START = {
    '甲': '丙', '己': '丙',
    '乙': '戊', '庚': '戊',
    '丙': '庚', '辛': '庚',
    '丁': '壬', '壬': '壬',
    '戊': '甲', '癸': '甲'
}

def get_palace_stems(year_gan):
    """
    根据年干获取十二宫的天干
    返回: {地支: 天干} 的字典
    """
    start_gan = WUHU_START[year_gan]
    start_idx = TIANGAN.index(start_gan)

    palace_stems = {}
    for i, dizhi in enumerate(DIZHI):
        gan_idx = (start_idx + i) % 10
        palace_stems[dizhi] = TIANGAN[gan_idx]

    return palace_stems

# 使用示例
# 甲年命宫在辰宫，宫干为戊
stems = get_palace_stems('甲')
print(stems['辰'])  # 输出：戊
```

---

## 四、宫干的用途

### 1. 宫干四化

每个宫位的天干可引发该宫的四化飞星：

```python
def get_gong_sihua(gong_gan):
    """获取某宫天干引发的四化"""
    return SIHUA_TABLE[gong_gan]

# 例：命宫天干为戊，引发：贪狼化禄、太阴化权、右弼化科、天机化忌
```

### 2. 大限宫干

大限（十年运）的宫干用于判断该限运势：

```python
def get_daxian_gan(year_gan, daxian_gong):
    """
    year_gan: 出生年干
    daxian_gong: 大限所在宫位地支
    """
    stems = get_palace_stems(year_gan)
    return stems[daxian_gong]
```

### 3. 流年宫干

流年天干直接使用该年的天干：

```python
def get_liunian_sihua(liunian_gan):
    """流年天干引发的四化"""
    return SIHUA_TABLE[liunian_gan]
```

---

## 五、快速查表

### 命宫天干速查

已知年干和命宫地支，可直接查表：

```python
GONG_GAN_TABLE = {
    ('甲', '寅'): '丙', ('甲', '卯'): '丁', ('甲', '辰'): '戊', ('甲', '巳'): '己',
    ('甲', '午'): '庚', ('甲', '未'): '辛', ('甲', '申'): '壬', ('甲', '酉'): '癸',
    ('甲', '戌'): '甲', ('甲', '亥'): '乙', ('甲', '子'): '丙', ('甲', '丑'): '丁',
    # ... 其他组合同理
}

def get_ming_gong_gan(year_gan, ming_gong_zhi):
    """快速获取命宫天干"""
    # 方法1：查表
    # return GONG_GAN_TABLE[(year_gan, ming_gong_zhi)]

    # 方法2：计算
    stems = get_palace_stems(year_gan)
    return stems[ming_gong_zhi]
```

---

## 参考资源

- [紫微斗数排盘详细步骤第一步 - 紫微取象派](https://www.ziweishuyuan.com/ziwei-place/168.html)
- [紫微斗数算法的实现流程 - 博客园](https://www.cnblogs.com/voidobject/p/18510346)
