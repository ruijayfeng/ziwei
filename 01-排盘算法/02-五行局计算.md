# 五行局计算

## 概述

五行局是紫微斗数排盘的关键参数，用于确定紫微星的位置。五行局由**命宫的干支纳音**决定。

## 五行局对照

| 局名 | 数值 | 五行 | 大限起运年龄 |
|------|------|------|-------------|
| 水二局 | 2 | 水 | 2岁 |
| 木三局 | 3 | 木 | 3岁 |
| 金四局 | 4 | 金 | 4岁 |
| 土五局 | 5 | 土 | 5岁 |
| 火六局 | 6 | 火 | 6岁 |

---

## 一、纳音五行速算法

### 口诀

> **甲乙丙丁一到五，子丑午未一来数**
> **寅卯申酉二上走，辰巳戌亥三为足**
> **干支相加多减五，五行木金水火土**

### 取数规则

**天干取数：**
| 天干 | 甲乙 | 丙丁 | 戊己 | 庚辛 | 壬癸 |
|------|------|------|------|------|------|
| 数值 | 1 | 2 | 3 | 4 | 5 |

**地支取数：**
| 地支 | 子丑午未 | 寅卯申酉 | 辰巳戌亥 |
|------|---------|---------|---------|
| 数值 | 1 | 2 | 3 |

**五行取数：**
| 五行 | 木 | 金 | 水 | 火 | 土 |
|------|----|----|----|----|----|
| 数值 | 1 | 2 | 3 | 4 | 5 |

### 计算方法

```python
def get_nayin_wuxing(tiangan, dizhi):
    """计算纳音五行"""
    # 天干取数
    TIANGAN_NUM = {'甲':1,'乙':1,'丙':2,'丁':2,'戊':3,'己':3,'庚':4,'辛':4,'壬':5,'癸':5}
    # 地支取数
    DIZHI_NUM = {'子':1,'丑':1,'午':1,'未':1,'寅':2,'卯':2,'申':2,'酉':2,'辰':3,'巳':3,'戌':3,'亥':3}
    # 五行对照
    WUXING = {1:'木', 2:'金', 3:'水', 4:'火', 5:'土'}

    total = TIANGAN_NUM[tiangan] + DIZHI_NUM[dizhi]
    if total > 5:
        total -= 5
    return WUXING[total]

def get_wuxing_ju(nayin_wuxing):
    """纳音五行转五行局"""
    JU_MAP = {'水':2, '木':3, '金':4, '土':5, '火':6}
    return JU_MAP[nayin_wuxing]
```

### 计算示例

**例1：命宫在甲子**
```
甲 = 1, 子 = 1
1 + 1 = 2 → 金
金 → 金四局
```

**例2：命宫在丙寅**
```
丙 = 2, 寅 = 2
2 + 2 = 4 → 火
火 → 火六局
```

**例3：命宫在戊辰**
```
戊 = 3, 辰 = 3
3 + 3 = 6 > 5, 6 - 5 = 1 → 木
木 → 木三局
```

---

## 二、天干地支五行局对照表（完整版）

### 按命宫口诀记忆

> **甲乙锦江烟**（金水火）
> **丙丁没谷田**（水火土）
> **戊己荧堤柳**（火土木）
> **庚辛挂杖钱**（土木金）
> **壬癸林锺满**（木金水）

### 完整对照表

| 天干 | 子丑午未 | 寅卯申酉 | 辰巳戌亥 |
|------|---------|---------|---------|
| 甲乙 | 金四局 | 水二局 | 火六局 |
| 丙丁 | 水二局 | 火六局 | 土五局 |
| 戊己 | 火六局 | 土五局 | 木三局 |
| 庚辛 | 土五局 | 木三局 | 金四局 |
| 壬癸 | 木三局 | 金四局 | 水二局 |

### 代码实现（查表法）

```python
WUXING_JU_TABLE = {
    ('甲','子'):4, ('甲','丑'):4, ('甲','午'):4, ('甲','未'):4,
    ('甲','寅'):2, ('甲','卯'):2, ('甲','申'):2, ('甲','酉'):2,
    ('甲','辰'):6, ('甲','巳'):6, ('甲','戌'):6, ('甲','亥'):6,
    ('乙','子'):4, ('乙','丑'):4, ('乙','午'):4, ('乙','未'):4,
    ('乙','寅'):2, ('乙','卯'):2, ('乙','申'):2, ('乙','酉'):2,
    ('乙','辰'):6, ('乙','巳'):6, ('乙','戌'):6, ('乙','亥'):6,
    ('丙','子'):2, ('丙','丑'):2, ('丙','午'):2, ('丙','未'):2,
    ('丙','寅'):6, ('丙','卯'):6, ('丙','申'):6, ('丙','酉'):6,
    ('丙','辰'):5, ('丙','巳'):5, ('丙','戌'):5, ('丙','亥'):5,
    ('丁','子'):2, ('丁','丑'):2, ('丁','午'):2, ('丁','未'):2,
    ('丁','寅'):6, ('丁','卯'):6, ('丁','申'):6, ('丁','酉'):6,
    ('丁','辰'):5, ('丁','巳'):5, ('丁','戌'):5, ('丁','亥'):5,
    ('戊','子'):6, ('戊','丑'):6, ('戊','午'):6, ('戊','未'):6,
    ('戊','寅'):5, ('戊','卯'):5, ('戊','申'):5, ('戊','酉'):5,
    ('戊','辰'):3, ('戊','巳'):3, ('戊','戌'):3, ('戊','亥'):3,
    ('己','子'):6, ('己','丑'):6, ('己','午'):6, ('己','未'):6,
    ('己','寅'):5, ('己','卯'):5, ('己','申'):5, ('己','酉'):5,
    ('己','辰'):3, ('己','巳'):3, ('己','戌'):3, ('己','亥'):3,
    ('庚','子'):5, ('庚','丑'):5, ('庚','午'):5, ('庚','未'):5,
    ('庚','寅'):3, ('庚','卯'):3, ('庚','申'):3, ('庚','酉'):3,
    ('庚','辰'):4, ('庚','巳'):4, ('庚','戌'):4, ('庚','亥'):4,
    ('辛','子'):5, ('辛','丑'):5, ('辛','午'):5, ('辛','未'):5,
    ('辛','寅'):3, ('辛','卯'):3, ('辛','申'):3, ('辛','酉'):3,
    ('辛','辰'):4, ('辛','巳'):4, ('辛','戌'):4, ('辛','亥'):4,
    ('壬','子'):3, ('壬','丑'):3, ('壬','午'):3, ('壬','未'):3,
    ('壬','寅'):4, ('壬','卯'):4, ('壬','申'):4, ('壬','酉'):4,
    ('壬','辰'):2, ('壬','巳'):2, ('壬','戌'):2, ('壬','亥'):2,
    ('癸','子'):3, ('癸','丑'):3, ('癸','午'):3, ('癸','未'):3,
    ('癸','寅'):4, ('癸','卯'):4, ('癸','申'):4, ('癸','酉'):4,
    ('癸','辰'):2, ('癸','巳'):2, ('癸','戌'):2, ('癸','亥'):2,
}

def get_wuxing_ju(tiangan, dizhi):
    return WUXING_JU_TABLE[(tiangan, dizhi)]
```

---

## 三、五行局的用途

### 1. 定紫微星位置

紫微星位置 = f(出生日, 五行局)

详见 `03-紫微星定位.md`

### 2. 定大限起运年龄

- 水二局：2岁起大限
- 木三局：3岁起大限
- 金四局：4岁起大限
- 土五局：5岁起大限
- 火六局：6岁起大限

### 3. 命格层次判断

同一紫微星位置，不同五行局的格局高低不同。

---

## 参考资源

- [紫微斗数如何定纳音五行局数 - 杨易德](https://www.yangyide.net/ziwei/4200.html)
- [六十甲子纳音表在紫微斗数中的应用 - 豆瓣](https://www.douban.com/group/topic/148304060/)
- [紫微斗数排盘详细步骤第二步 - 紫微取象派](https://www.ziweishuyuan.com/ziwei-place/181.html)
